"use strict";sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/core/library","./Util","../enums"],function(e,t,s,a){"use strict";function r(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const i=t["MessageType"];const n=r(s);const o=a["CustomMessageTypes"];const l=e.extend("cc.spreadsheetimporter.v1_1_1.Parser",{});l.parseSpreadsheetData=function e(t,s,a,r,i,o){const l=[];for(const[e,d]of t.entries()){let t={};for(const[l,p]of s.entries()){const s=n.getValueFromRow(d,p.label,l,a.getFieldMatchType());if(s&&s.rawValue!==undefined&&s.rawValue!==null&&s.rawValue!==""){const n=s.rawValue;if(p.type==="Edm.Boolean"){if(typeof n==="boolean"||n==="true"||n==="false"){t[l]=Boolean(n)}else{this.addMessageToMessages("spreadsheetimporter.valueNotABoolean",i,r,e,[p.label],n)}}else if(p.type==="Edm.Date"){let a=n;if(s.sheetDataType!=="d"){const t=new Date(n);if(isNaN(t.getTime())){this.addMessageToMessages("spreadsheetimporter.invalidDate",i,r,e,[p.label],n);continue}a=t}try{this.checkDate(a,p,i,r,e);const s=`${a.getUTCFullYear()}-${("0"+(a.getUTCMonth()+1)).slice(-2)}-${("0"+a.getUTCDate()).slice(-2)}`;t[l]=s}catch(t){this.addMessageToMessages("spreadsheetimporter.errorWhileParsing",i,r,e,[p.label],n)}}else if(p.type==="Edm.DateTimeOffset"||p.type==="Edm.DateTime"){let a=n;if(s.sheetDataType!=="d"){const t=new Date(n);if(isNaN(t.getTime())){this.addMessageToMessages("spreadsheetimporter.invalidDate",i,r,e,[p.label],n);continue}a=t}try{this.checkDate(a,p,i,r,e);t[l]=a}catch(t){this.addMessageToMessages("spreadsheetimporter.errorWhileParsing",i,r,e,[p.label],n)}}else if(p.type==="Edm.TimeOfDay"||p.type==="Edm.Time"){let a=n;if(s.sheetDataType!=="d"){a=new Date(n)}if(a&&!isNaN(a.getTime())){const e=a.toISOString().substring(11,19);t[l]=e}else{const s=this.parseTimePattern(n,i,r,e,p);if(s){t[l]=s}}}else if(p.type==="Edm.UInt8"||p.type==="Edm.Int16"||p.type==="Edm.Int32"||p.type==="Edm.Integer"||p.type==="Edm.Int64"||p.type==="Edm.Integer64"||p.type==="Edm.Byte"||p.type==="Edm.SByte"){try{const n=this.checkInteger(s,p,i,r,e,a);if(o){if(p.type==="Edm.Int64"||p.type==="Edm.Integer64"){t[l]=n.toString()}else{t[l]=n}}else{if(p.type==="Edm.Int16"||p.type==="Edm.Int32"||p.type==="Edm.Byte"||p.type==="Edm.SByte"){t[l]=n}else{t[l]=n.toString()}}}catch(t){this.addMessageToMessages("spreadsheetimporter.errorWhileParsing",i,r,e,[p.label],n)}}else if(p.type==="Edm.Double"||p.type==="Edm.Decimal"){try{const n=this.checkDouble(s,p,i,r,e,a);if(o){if(p.type==="Edm.Double"){t[l]=n}if(p.type==="Edm.Decimal"){t[l]=n.toString()}}else{t[l]=n.toString()}}catch(t){this.addMessageToMessages("spreadsheetimporter.errorWhileParsing",i,r,e,[p.label],n)}}else{t[l]=`${n??""}`}}}if(a.getSpreadsheetRowPropertyName()){t[a.getSpreadsheetRowPropertyName()]=d["__rowNum__"]+1}l.push(t)}return l};l.checkDate=function e(t,s,a,r,i){if(isNaN(t.getTime())){this.addMessageToMessages("spreadsheetimporter.invalidDate",a,r,i,[s.label],t.rawValue);return false}return true};l.checkDouble=function e(t,s,a,r,i,o){const l=t.rawValue;let d=l;if(typeof l==="string"){const e=n.normalizeNumberString(l,o);d=parseFloat(e);if(/[^0-9.,]/.test(d)||parseFloat(e).toString()!==e){this.addMessageToMessages("spreadsheetimporter.parsingErrorNotNumber",a,r,i,[s.label],l)}}return d};l.checkInteger=function e(t,s,a,r,i,o){const l=t.rawValue;let d=l;if(!Number.isInteger(d)){if(typeof l==="string"){const e=n.normalizeNumberString(l,o);d=parseInt(e);if(/[^0-9]/.test(d)||parseInt(e).toString()!==e.toString()){this.addMessageToMessages("spreadsheetimporter.parsingErrorNotWholeNumber",a,r,i,[s.label],l)}}}return d};l.addMessageToMessages=function e(t,s,a,r,n,l,d){a.addMessageToMessages({title:s.geti18nText(t,n),row:r+2,type:o.ParsingError,counter:1,rawValue:l,formattedValue:d,ui5type:i.Error})};l.parseTimePattern=function e(t,s,a,r,i){const n=/^(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?$/;const o=t.match(n);if(o){const e=parseInt(o[1],10);const n=parseInt(o[2],10);const l=o[3]?parseInt(o[3],10):0;const d=o[4]?parseInt(o[4],10):0;if(e<24&&n<60&&l<60){let t=new Date;t.setHours(e,n,l,d);const s=`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`;return s}else{this.addMessageToMessages("spreadsheetimporter.invalidTime",s,a,r,[i.label],t)}}else{this.addMessageToMessages("spreadsheetimporter.invalidTimeFormat",s,a,r,[i.label],t)}return null};return l});
//# sourceMappingURL=Parser.js.map